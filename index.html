<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.jsdelivr.net/npm/bignumber.js@9.3.1/bignumber.min.js"></script>
    <title>GPSの標高データによる時間の速さシミュレーション</title>
</head>
<body>
    <h1>GPSの標高データによる時間の速さシミュレーション</h1>
    <p id="altitudeBase">計算上の基準標高：44.4m</p>
    <p id="altitude">GPSデータを取得中...</p>
    <p id="timeDiff"></p>

    <script>
        function calculateTimeDilation(height) {
            // グラビトン定数をBigNumberで表現
            var G = new BigNumber('6.67430e-11');

            // 光速をBigNumberで表現
            var c = new BigNumber('299792458');

            // 地球の質量をBigNumberで表現
            var M = new BigNumber('5.972e24');

            // 地球の半径をBigNumberで表現
            var R = new BigNumber('6371000');

            // 高さを定義
            var h0 = new BigNumber(height);

            // 重力による時間影響の計算 : 1 / sqrt(1 - (2GM)/(c^2(R+h0)))
            var two = new BigNumber('2');
            var GM = G.multipliedBy(M); 
            var c2 = c.multipliedBy(c);
            var R_plus_h0 = R.plus(h0);
            var fraction = GM.multipliedBy(two).dividedBy(c2.multipliedBy(R_plus_h0));
            var timeDilationFactor = new BigNumber('1').dividedBy((new BigNumber('1').minus(fraction)).sqrt());
            return timeDilationFactor;
        }

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(function(position) {
                const altitude = position.coords.altitude;   // 標高
                // 標高が取得できれば表示、それ以外の場合はメッセージを表示
                if (altitude !== null) {
                    document.getElementById('altitude').innerHTML = `現在の標高: ${altitude} m`;


                    let timeBase = calculateTimeDilation(44.4); // 0 m
                    let timeTarget = calculateTimeDilation(altitude); // 
                    let timeRate = timeBase.dividedBy(timeTarget);
                    let timeDiff = timeRate.minus(new BigNumber('1'));
                    let timeDiffPerDay = timeDiff.multipliedBy(new BigNumber('86400')); // 1日の秒数
                    let timePicoSecPerDay = timeDiffPerDay.multipliedBy(new BigNumber('1e12')); // ピコ秒に変換
                    if (timePicoSecPerDay.isGreaterThan(0)) {
                        document.getElementById('timeDiff').innerHTML = `ここでは1日あたり ${timePicoSecPerDay} ピコ秒だけ時間が速く進みます。`;   
                    }
                    else {
                        document.getElementById('timeDiff').innerHTML = `ここでは1日あたり ${timePicoSecPerDay.abs()} ピコ秒だけ時間が遅く進みます。`;   
                    }

                } else {
                    document.getElementById('altitude').innerHTML = "標高情報は利用できません。";
                }
            }, function(error) {
                document.getElementById('altitude').innerHTML = "標高情報は利用できません。";
            });
        } else {
            document.getElementById('altitude').innerHTML = "標高情報は利用できません。";
        }
    </script>
</body>
</html>
